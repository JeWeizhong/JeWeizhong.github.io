---
title: 爬虫系列(一)---抓取电影评分top100
categories: 
  - 爬虫
tags:
  - 爬虫
  - python3
  
date: 2018-11-20
mathjax: true

---

```python
import requests
from bs4 import BeautifulSoup
import os
import re
from requests.exceptions import RequestException
from multiprocessing import Pool

'''
抓取猫眼电影网，历史电影评分top100
'''

def getHtml(url):
    '''
    获取网页内容
    '''
    try:
        # 我也不知道为什么要加请求头才可以
        headers = {'User-Agent':'Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/57.0.2987.110 Safari/537.36'}
        response = requests.get(url,headers=headers)
        #print(response.status_code)
        if response.status_code == 200:
            return response.text
        return None
    except RequestException as e:
        print(e)
        return None

def parseHtml(html):
    '''
    解析网页,抓取：电影排名，分数，上映时间，主演，封面url
    '''
    #找到所有 dd 标签
    soup = BeautifulSoup(html,"lxml")
    films = soup.find_all("dd")
    outList = []
    for i in films:
        # 排名
        num = i.find_all("i",{"class":re.compile("board-index board-index.+\d+")})[0].get_text().strip()
        # 影名
        name = i.find_all("p",{"class":"name"})[0].get_text().strip()
        # 评分
        score = i.find_all("p",{"class":"score"})[0].get_text().strip()
        #print(score)
        # 时间
        releaseTime = i.find_all("p",{"class":"releasetime"})[0].get_text().strip()
        # 主演
        star = i.find_all("p",{"class":"star"})[0].get_text().strip()
        outList.append([num,name,score,releaseTime,star])
    return outList

def main(index):
    url = f"http://ma oyan.com/board/4?offset={index}"
    
    html = getHtml(url)
    outList = parseHtml(html)
    for i in outList:
        print(i)

if __name__ == "__main__":
    #pool = Pool()
    for i in range(10):
        main(i*10)

```

输出：
```
['1', '霸王别姬', '9.6', '上映时间：1993-01-01', '主演：张国荣,张丰毅,巩俐']
['2', '肖申克的救赎', '9.5', '上映时间：1994-10-14(美国)', '主演：蒂姆·罗宾斯,摩根·弗里曼,鲍勃·冈顿']
['3', '罗马假日', '9.1', '上映时间：1953-09-02(美国)', '主演：格利高里·派克,奥黛丽·赫本,埃迪·艾伯特']
['4', '这个杀手不太冷', '9.5', '上映时间：1994-09-14(法国)', '主演：让·雷诺,加里·奥德曼,娜塔莉·波特曼']
['5', '教父', '9.3', '上映时间：1972-03-24(美国)', '主演：马龙·白兰度,阿尔·帕西诺,詹姆斯·肯恩']
['6', '泰坦尼克号', '9.5', '上映时间：1998-04-03', '主演：莱昂纳多·迪卡普里奥,凯特·温丝莱特,比利·赞恩']
['7', '唐伯虎点秋香', '9.2', '上映时间：1993-07-01(中国香港)', '主演：周星驰,巩俐,郑佩佩']
['8', '千与千寻', '9.3', '上映时间：2001-07-20(日本)', '主演：柊瑠美,入野自由,夏木真理']
['9', '魂断蓝桥', '9.2', '上映时间：1940-05-17(美国)', '主演：费雯·丽,罗伯特·泰勒,露塞尔·沃特森']
['10', '乱世佳人', '9.1', '上映时间：1939-12-15(美国)', '主演：费雯·丽,克拉克·盖博,奥利维娅·德哈维兰']
(后面省略)
```
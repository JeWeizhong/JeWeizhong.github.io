---
title: 爬虫系列(三)---抓取淘宝商品
categories: 
  - 爬虫
tags:
  - 爬虫
  - python3
  
date: 2018-11-22
mathjax: true

---

```python
from selenium import webdriver
import time
import requests
from bs4 import BeautifulSoup
import html.parser

from selenium.webdriver.common.by import By
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC
from selenium.webdriver.common.keys import Keys
from selenium.webdriver import ActionChains
from selenium.webdriver.common.desired_capabilities import DesiredCapabilities
from pyquery import PyQuery as pq

browser = webdriver.Chrome("E:\\Program Files\\chromedriver_win32\\chromedriver.exe")
#browser = webdriver.Chrome()
wait = WebDriverWait(browser, 10)

def getProducts():
    """
    提取商品数据
    """
    html = browser.page_source
    # 解析
    doc = pq(html)
    # 找id，子标签是商品列表
    items = doc('#mainsrp-itemlist .items .item').items()
    for item in items:
        product = {
            'image': item.find('.pic .img').attr('data-src'),
            'price': item.find('.price').text(),
            'deal': item.find('.deal-cnt').text(),
            'title': item.find('.title').text(),
            'shop': item.find('.shop').text(),
            'location': item.find('.location').text()
        }
        print(product)

def search():
    try:
        browser.get("https://www.taobao.com/")
        # 登陆，淘宝反爬虫，目前是手动扫码登陆，做了个sleep等待时间
        login = wait.until(
            EC.element_to_be_clickable((By.CSS_SELECTOR,'#J_SiteNavLogin > div.site-nav-menu-hd > div.site-nav-sign > a.h'))
        )
        login.click()
        time.sleep(30)
        # 输入框
        input = wait.until(
            EC.presence_of_element_located((By.CSS_SELECTOR, "#q"))
        )
        # 搜索按钮
        submit = wait.until(
            EC.element_to_be_clickable((By.CSS_SELECTOR,"#J_TSearchForm > div.search-button > button"))
        )
        # 输入
        input.send_keys("美食")
        # 点击搜索
        submit.click()
        getProducts()
    except TimeoutError:
        return  search()

def main():
    search()
    browser.close()

if __name__ == "__main__":
    main()
```